# Migration `20201118130346-movies`

This migration has been generated by Lewis Blackburn at 11/18/2020, 1:03:46 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Movie" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updateAt" TIMESTAMP(3) NOT NULL,
    "banner" TEXT,
    "art" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "age" TEXT NOT NULL,
    "release" TEXT NOT NULL,
    "trailer" TEXT NOT NULL,
    "tagline" TEXT NOT NULL,
    "overview" TEXT NOT NULL,
    "runtime" INTEGER NOT NULL,
    "status" TEXT NOT NULL,
    "language" TEXT,
    "budget" INTEGER,
    "revenue" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "Actor" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updateAt" TIMESTAMP(3) NOT NULL,
    "image" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "age" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "ActorsOnMovies" (
    "role" TEXT NOT NULL,
    "movieId" INTEGER NOT NULL,
    "actorId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("movieId","actorId")
)

CREATE TABLE "Genre" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updateAt" TIMESTAMP(3) NOT NULL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "GenresOnMoives" (
    "movieId" INTEGER NOT NULL,
    "genreId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("movieId","genreId")
)

CREATE TABLE "Review" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updateAt" TIMESTAMP(3) NOT NULL,
    "title" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "by" TEXT NOT NULL,
    "movieId" INTEGER,
    "userId" INTEGER,
    "ratingUserId" INTEGER NOT NULL,
    "ratingMovieId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Favourite" (
    "userId" INTEGER NOT NULL,
    "movieId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("userId","movieId")
)

CREATE TABLE "Rating" (
    "value" INTEGER NOT NULL DEFAULT 0,
    "userId" INTEGER NOT NULL,
    "movieId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("userId","movieId")
)

ALTER TABLE "ActorsOnMovies" ADD FOREIGN KEY("movieId")REFERENCES "Movie"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "ActorsOnMovies" ADD FOREIGN KEY("actorId")REFERENCES "Actor"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "GenresOnMoives" ADD FOREIGN KEY("movieId")REFERENCES "Movie"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "GenresOnMoives" ADD FOREIGN KEY("genreId")REFERENCES "Genre"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Review" ADD FOREIGN KEY("ratingUserId", "ratingMovieId")REFERENCES "Rating"("userId","movieId") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Review" ADD FOREIGN KEY("movieId")REFERENCES "Movie"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Review" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Favourite" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Favourite" ADD FOREIGN KEY("movieId")REFERENCES "Movie"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("movieId")REFERENCES "Movie"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201118123220-postgres..20201118130346-movies
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -12,16 +12,19 @@
 // --------------------------------------
 model User {
-  id             Int       @id @default(autoincrement())
-  createdAt      DateTime  @default(now())
-  updatedAt      DateTime  @updatedAt
+  id             Int         @id @default(autoincrement())
+  createdAt      DateTime    @default(now())
+  updatedAt      DateTime    @updatedAt
   name           String?
-  email          String    @unique
+  email          String      @unique
   hashedPassword String?
-  role           String    @default("user")
+  role           String      @default("user")
   sessions       Session[]
+  reviews        Review[]
+  favourites     Favourite[]
+  ratings        Rating[]
 }
 model Session {
   id                 Int       @id @default(autoincrement())
@@ -35,4 +38,105 @@
   antiCSRFToken      String?
   publicData         String?
   privateData        String?
 }
+
+model Movie {
+  id         Int              @id @default(autoincrement())
+  createdAt  DateTime         @default(now())
+  updateAt   DateTime         @updatedAt
+  banner     String?
+  art        String
+  title      String
+  age        String
+  release    String
+  genres     GenresOnMoives[]
+  trailer    String
+  tagline    String
+  overview   String
+  runtime    Int
+  actors     ActorsOnMovies[]
+  status     String
+  language   String?
+  budget     Int?
+  revenue    Int?
+  reivews    Review[]
+  favourites Favourite[]
+  ratings    Rating[]
+}
+
+model Actor {
+  id        Int              @id @default(autoincrement())
+  createdAt DateTime         @default(now())
+  updateAt  DateTime         @updatedAt
+  image     String
+  name      String
+  age       Int
+  movies    ActorsOnMovies[]
+}
+
+model ActorsOnMovies {
+  role      String
+  movie     Movie    @relation(fields: [movieId], references: [id])
+  movieId   Int
+  actor     Actor    @relation(fields: [actorId], references: [id])
+  actorId   Int
+  createdAt DateTime @default(now())
+
+  @@id([movieId, actorId])
+}
+
+model Genre {
+  id        Int              @id @default(autoincrement())
+  createdAt DateTime         @default(now())
+  updateAt  DateTime         @updatedAt
+  name      String
+  movies    GenresOnMoives[]
+}
+
+model GenresOnMoives {
+  movie     Movie    @relation(fields: [movieId], references: [id])
+  movieId   Int
+  genre     Genre    @relation(fields: [genreId], references: [id])
+  genreId   Int
+  createdAt DateTime @default(now())
+
+  @@id([movieId, genreId])
+}
+
+model Review {
+  id            Int      @id @default(autoincrement())
+  createdAt     DateTime @default(now())
+  updateAt      DateTime @updatedAt
+  title         String
+  content       String
+  by            String
+  rating        Rating   @relation(fields: [ratingUserId, ratingMovieId], references: [userId, movieId])
+  movie         Movie?   @relation(fields: [movieId], references: [id])
+  movieId       Int?
+  user          User?    @relation(fields: [userId], references: [id])
+  userId        Int?
+  ratingUserId  Int
+  ratingMovieId Int
+}
+
+model Favourite {
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  movie     Movie    @relation(fields: [movieId], references: [id])
+  movieId   Int
+  createdAt DateTime @default(now())
+
+  @@id([userId, movieId])
+}
+
+model Rating {
+  value     Int      @default(0)
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  movie     Movie    @relation(fields: [movieId], references: [id])
+  movieId   Int
+  createdAt DateTime @default(now())
+  review    Review[]
+
+  @@id([userId, movieId])
+}
```


